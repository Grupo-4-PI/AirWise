<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Rosaria Moda</title>
  <link rel="stylesheet" href="../../../css/aplicacao/assets/main-dash.css" />
  <link rel="stylesheet" href="../../../css/aplicacao/dash-geral.css" />
</head>

<!-- onload="carregarVisaoGeral()" -->

<body onload="carregarVisaoGeral()">
  <!-- Menu lateral -->
  <aside class="sidebar" aria-label="Barra lateral de navegação">
    <header class="sidebar-top">
      <div class="container-header-company">
        <button class="toggle-btn" aria-label="Alternar menu" title="Alternar menu">
          <i class="bx bx-menu"></i>
        </button>

        <div class="container-logotipo">
          <img src="../../../assets/logotipo/logotipo-airwise-pad-white.png" alt="" />
        </div>
      </div>

      <div class="brand">
        <div class="brand-avatar">
          <img
            src="https://images.vexels.com/media/users/3/137047/isolated/preview/5831a17a290077c646a48c4db78a81bb-icone-azul-do-perfil-de-usuario.png"
            alt="" />
        </div>
        <div class="brand-text">
          <h3 id="nome_usuario"></h3>
          <p id="cargo_usuario"></p>
        </div>
      </div>
    </header>

    <nav class="menu" role="navigation" aria-label="Menu principal">
      <a href="../dash-geral/dash-main.html">
        <button class="menu-btn active" aria-pressed="true">
          <i class="bx bx-home"></i>
          <p class="label">Home</p>
        </button>
      </a>

      <a href="../dash-reclamacoes/dash-reclamacoes.html">
        <button class="menu-btn" aria-pressed="false">
          <i class="bx bx-error"></i>
          <p class="label">Reclamações</p>
        </button>
      </a>

      <a href="../dash-marketing-company/dash-marketing-company.html">
        <button class="menu-btn">
          <i class="bx bx-line-chart"></i>
          <p class="label">Desempenho Interno</p>
        </button>
      </a>

      <a href="../dash-benchmark/dash-benchmark.html">
        <button class="menu-btn">
          <i class="bx bx-line-chart"></i>
          <p class="label">Benchmark</p>
        </button>
      </a>

      <a href="../../CRUD/gestao_usuario.html">
        <button class="menu-btn">
          <i class='bx  bx-user' style='color:#ffffff'></i>
          <p class="label">Gestão de Usuários</p>
        </button>
      </a>
    </nav>

    <footer class="footer-sidebar">
      <div class="footer-actions">
        <a href="../../login/login.html">
          <button class="menu-btn">
            <i class="bx bx-log-out"></i>
            <p class="label">Sair</p>
          </button>
        </a>
      </div>
    </footer>
  </aside>

  <!-- Conteúdo principal -->
  <main class="main-content">
    <header class="header" role="banner" aria-label="Barra superior do painel">
      <div class="header-left">
        <h1 class="page-title">Home - Gol Linhas Aéreas</h1>
        <p class="subtitle">
          Visão geral das reclamações, eficiência e tendências
        </p>
      </div>

      <div class="header-actions" role="region" aria-label="Controles do painel">
        <!-- <div class="range">
          <label for="period" class="sr-only">Período</label>
          <select id="period" name="period" aria-label="Selecionar período">
            <option>Últimos 30 dias</option>
            <option>Últimos 90 dias</option>
            <option>Últimos 12 meses</option>
          </select>
        </div> -->
      </div>
    </header>

    <!-- KPIs -->
    <section class="stats">
      <div class="card">
        <img src="../../../assets/dasboard/star.png" alt="Ícone estrela" class="kpi-img" />
        <div>
          <strong id="kpi_nota">4,03/5</strong>
          <p>Nota média dos consumidores (30d)</p>
        </div>
      </div>

      <div class="card">
        <img src="../../../assets/dasboard/clock.png" alt="Ícone relógio" class="kpi-img" />
        <div>
          <strong id="tempo_resposta">15h 33min</strong>
          <p>Tempo médio de resolução</p>
        </div>
      </div>

      <div class="card">
        <img src="../../../assets/dasboard/check.png" alt="Ícone check" class="kpi-img" />
        <div>
          <strong id="taxa_solucao">77,97%</strong>
          <p>Taxa de solução dos chamados</p>
        </div>
      </div>

      <div class="card">
        <img src="../../../assets/dasboard/call.png" alt="Ícone usuário" class="kpi-img" />
        <div>
          <strong id="total_chamados">17138</strong>
          <p>Total de chamados abertos (30d)</p>
        </div>
      </div>
    </section>

    <!-- Gráficos  -->
    <section class="charts">
      <div class="chart">
        <h3>Comparativo Mensal da Nota média</h3>
        <canvas id="graficoNota"></canvas>
      </div>

      <div class="chart">
        <h3>Estados com mais reclamações vs Nota média</h3>
        <canvas id="graficoEstados"></canvas>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../../../script/assets-aplicacao/validarAcesso.js"></script>
  <script>
    function carregarVisaoGeral() {
      const nomeEmpresaBruto = JSON.parse(
        sessionStorage.getItem("data_user")
      );

      const nomeEmpresaServer = nomeEmpresaBruto.nomeEmpresa;

      fetch(
        `/visaoGeral/dadosDashVisaoGeral?nomeEmpresaServer=${encodeURIComponent(
          nomeEmpresaServer
        )}`
      )
        .then((resposta) => {
          if (!resposta.ok) {
            throw new Error("Erro ao buscar dados da visão geral");
          }
          return resposta.json();
        })
        .then((dados) => {
          const { kpis, grafico1, grafico2 } = dados;
          const nota_consumidores = document.getElementById('kpi_nota');
          const tempo_medio_resposta = document.getElementById('tempo_resposta');
          const taxa_solucao_chamados = document.getElementById('taxa_solucao');
          const total_chamados_abertos = document.getElementById('total_chamados');

          nota_consumidores.textContent = kpis[0].media_nota_consumidor + "/5";
          tempo_medio_resposta.textContent = kpis[0].media_tempo_resposta + "Horas";
          taxa_solucao_chamados.textContent = kpis[0].total_respondidas;
          total_chamados_abertos.textContent = kpis[0].total_reclamacoes;

          const arrayGrafico1 = [];
          const arrayGrafico2reclamacoes = [];
          const arrayGrafico2nota = [];
          const arrayGrafico2uf = [];

for (let G1 = 0; G1 < grafico1.length; G1++) {
  arrayGrafico1.push(grafico1[G1].media_nota)
}

for (let G2 = 0; G2 < grafico2.length; G2++) {
 arrayGrafico2reclamacoes.push(grafico2[G2].total);
 arrayGrafico2nota.push(grafico2[G2].media_nota);
 arrayGrafico2uf.push(grafico2[G2].uf);
}

grafico1NotaMedia(arrayGrafico1);

grafico2Estados(arrayGrafico2uf, arrayGrafico2nota, arrayGrafico2reclamacoes);

        })
        .catch((erro) => {
          console.error("❌ Erro no fetch:", erro);
        });
    }

    // Gráfico 1 - Nota média mensal

    function grafico1NotaMedia(dados) {
      // Gráfico 1 - Nota média mensal
      const ctx1 = document.getElementById("graficoNota").getContext("2d");
      new Chart(ctx1, {
        type: "line",
        data: {
          labels: [
            "Jan",
            "Fev",
            "Mar",
            "Abr",
            "Mai",
            "Jun",
            "Jul",
            "Set",
            "Out",
            "Nov",
            "Dez",
          ],
          datasets: [
            {
              label: "Nota média",
              data: dados,
              borderColor: "#3158A4",
              backgroundColor: "rgba(49, 88, 164, 0.2)",
              tension: 0.4,
              fill: true,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
          },
          scales: {
            y: { beginAtZero: false, min: 0, max: 5 },
          },
        },
      });
    }

    function grafico2Estados(uf , media_nota, total) {
      const ctx2 = document.getElementById("graficoEstados").getContext("2d");
      new Chart(ctx2, {
        data: {
          labels: uf,
          datasets: [
            {
              label: "Nota",
              data: media_nota,
              type: "line",
              borderColor: "#F47C36",
              backgroundColor: "#F47C36",
              borderWidth: 2,
              tension: 0.3,
              yAxisID: "y1",
            },
            {
              label: "Qtd",
              data: total,
              type: "bar",
              backgroundColor: "#155978",
              borderRadius: 4,
              yAxisID: "y",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: false,
              text: "Estados com mais reclamações vs Nota média",
              font: { size: 16 },
            },
            legend: {
              position: "bottom",
            },
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: false },
              position: "left",
              ticks: { stepSize: 1000 },
            },
            y1: {
              beginAtZero: false,
              min: 0,
              max: 5,
              position: "right",
              grid: { drawOnChartArea: false },
              ticks: { stepSize: 0.5 },
            },
          },
        },
      });
    }


// Nome Usuario e cargo

    const nome = document.getElementById('nome_usuario');
    const cargo = document.getElementById('cargo_usuario');
    const dados_usuario = JSON.parse(sessionStorage.getItem("data_user"))

    nome.textContent = dados_usuario.nome;

    cargo.textContent = dados_usuario.cargo;

// ------------------------------------------------------------------------

  </script>
  <script src="../../../script/assets-aplicacao/sidebar.js"></script>
</body>

</html>